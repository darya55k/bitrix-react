{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/entities/params.ts","webpack:///./src/utils/parse-window-name.ts","webpack:///./src/utils/unique-key.ts","webpack:///./src/message-sender.ts","webpack:///./src/bx24.ts","webpack:///./src/index.ts"],"names":["root","factory","exports","module","define","amd","a","i","self","this","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Params","currentTime","Date","now","_authExpires","parseInt","ACCESS_TOKEN","AUTH_ID","DOMAIN","EXPIRES_IN","MEMBER_ID","REFRESH_TOKEN","REFRESH_ID","parseWindowName","windowName","params","q","split","replace","PROTOCOL","APP_SID","uniqueKey","counter","Math","random","toString","slice","MessageSender","currentWindow","parentWindow","message_sender_classCallCheck","message_sender_defineProperty","_params","_currentWindow","_parentWindow","_resolvers","_uniqueKey","_setListener","cmd","resolverKey","_this","promise","Promise","resolve","_addResolver","JSON","stringify","join","url","postMessage","resolver","addEventListener","_eventHandler","e","arr","data","match","length","parse","BX24","arguments","undefined","window","parent","bx24_classCallCheck","bx24_defineProperty","_messageSender","_checkAuth","getAuth","reject","send","then","assign","catch","err","authExpires","getAuthExpires","__webpack_exports__","bx24"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import IAuth from './auth';\r\n\r\nclass Params {\r\n  public DOMAIN?: string;\r\n  public PROTOCOL?: number;\r\n  public APP_SID?: string;\r\n  public PATH?: string;\r\n  public LANG?: string;\r\n  public AUTH_ID?: string;\r\n  public REFRESH_ID?: string | null;\r\n  public MEMBER_ID?: string | null;\r\n  public PLACEMENT?: string | null;\r\n  public IS_ADMIN?: boolean;\r\n  public AUTH_EXPIRES?: string;\r\n  public USER_OPTIONS?: object | null;\r\n  public APP_OPTIONS?: object | null;\r\n  public PLACEMENT_OPTIONS?: object | null;\r\n  private _authExpires?: number;\r\n\r\n  public setAuthExpires(value: string): void {\r\n    const currentTime: number = Date.now();\r\n    this._authExpires = currentTime + parseInt(value, 10) * 1000;\r\n  }\r\n\r\n  public getAuthExpires(): number | undefined {\r\n    return this._authExpires;\r\n  }\r\n\r\n  public getAuth(): IAuth {\r\n    return {\r\n      ACCESS_TOKEN: this.AUTH_ID,\r\n      DOMAIN: this.DOMAIN,\r\n      EXPIRES_IN: this._authExpires,\r\n      MEMBER_ID: this.MEMBER_ID,\r\n      REFRESH_TOKEN: this.REFRESH_ID,\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport default Params;\r\n","import Params from '../entities/params';\r\n\r\n/**\r\n * \r\n * @param windowName \r\n * @param params \r\n */\r\nfunction parseWindowName(windowName: string, params: Params): void {\r\n  const q = windowName.split('|');\r\n  params.DOMAIN = q[0].replace(/\\:(80|443)$/, '');\r\n  params.PROTOCOL = parseInt(q[1], 10) || 0;\r\n  params.APP_SID = q[2];\r\n}\r\n\r\nexport default parseWindowName;\r\n","function uniqueKey(): string {\r\n    let key = '';\r\n    for (let counter = 0; counter < 4; counter++) {\r\n      key += Math.random()\r\n        .toString(32)\r\n        .slice(2, 8);\r\n    }\r\n    return key;\r\n}\r\n\r\nexport default uniqueKey;","import Params from './entities/params';\r\nimport parseWindowName from './utils/parse-window-name';\r\nimport uniqueKey from './utils/unique-key'\r\n\r\ntype FunctionReturnString = () => string;\r\n\r\n\r\nclass MessageSender {\r\n  private _currentWindow: Window;\r\n  private _parentWindow: Window;\r\n  private _params: Params;\r\n  private _resolvers: any;\r\n  private _uniqueKey: FunctionReturnString;\r\n\r\n  constructor(currentWindow: Window, parentWindow: Window, params: Params) {\r\n    this._params = params;\r\n    this._currentWindow = currentWindow;\r\n    this._parentWindow = parentWindow;\r\n    this._resolvers = {};\r\n    this._uniqueKey = uniqueKey;\r\n\r\n    parseWindowName(currentWindow.name, this._params);\r\n    this._setListener();\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param cmd\r\n   * @param callback\r\n   * @param params\r\n   */\r\n  public send(cmd: string, params?: object): Promise<any> {\r\n    let resolverKey;\r\n    const promise = new Promise<any>(resolve => {\r\n      resolverKey = this._addResolver(resolve);\r\n    });\r\n\r\n    cmd += [!!params ? JSON.stringify(params) : '', resolverKey].join(':');\r\n    if (!!this._params.APP_SID) {\r\n      cmd = [cmd, this._params.APP_SID].join(':');\r\n    }\r\n    const url =\r\n      'http' + (this._params.PROTOCOL ? 's' : '') + '://' + this._params.DOMAIN;\r\n    this._parentWindow.postMessage(cmd, url);\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param resolver\r\n   * @param callback\r\n   */\r\n  private _addResolver(resolver: Function): string {\r\n    const key = this._uniqueKey();\r\n    this._resolvers[key] = resolver;\r\n    return key;\r\n  }\r\n\r\n  private _setListener(): void {\r\n    this._currentWindow.addEventListener(\r\n      'message',\r\n      this._eventHandler.bind(this),\r\n    );\r\n  }\r\n\r\n  private _eventHandler(e: MessageEvent): void {\r\n    const arr = e.data.match(/(^.*?):(.*$)/);\r\n    if (arr.length === 3) {\r\n      this._resolvers[arr[1]].call(null, JSON.parse(arr[2]));\r\n    }\r\n  }\r\n}\r\n\r\nexport default MessageSender;\r\n","import IAuth from './entities/auth';\r\nimport Params from './entities/params';\r\nimport MessageSender from './message-sender';\r\n\r\nclass BX24 {\r\n  private _messageSender: MessageSender;\r\n  private _params!: Params;\r\n\r\n  constructor(currentWindow: Window = window, parentWindow: Window = parent) {\r\n    this._params = new Params();\r\n    this._messageSender = new MessageSender(\r\n      currentWindow,\r\n      parentWindow,\r\n      this._params,\r\n    );\r\n  }\r\n\r\n  public getAuth(): Promise<IAuth> {\r\n    let resultPromise: Promise<IAuth>;\r\n    if (this._checkAuth()) {\r\n      resultPromise = Promise.resolve(this._params.getAuth());\r\n    } else {\r\n      resultPromise = new Promise<IAuth>((resolve, reject) => {\r\n        this._messageSender\r\n          .send('getInitData')\r\n          .then((params: Params) => {\r\n            this._params = Object.assign(this._params, params);\r\n            resolve(this._params.getAuth());\r\n          })\r\n          .catch(err => {\r\n            reject(err);\r\n          });\r\n      });\r\n    }\r\n    return resultPromise;\r\n  }\r\n\r\n  private _checkAuth(): boolean {\r\n    const authExpires = this._params.getAuthExpires();\r\n    const check =\r\n      typeof this._params.APP_SID !== 'undefined' &&\r\n      typeof authExpires === 'number' &&\r\n      authExpires > Date.now();\r\n    return check;\r\n  }\r\n}\r\n\r\nexport default BX24;\r\n","import BX24 from './bx24';\r\n\r\nexport { BX24 };\r\n"],"sourceRoot":""}